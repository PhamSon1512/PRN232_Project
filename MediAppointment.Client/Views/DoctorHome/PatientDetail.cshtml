@model MediAppointment.Client.Models.Doctor.Doctor_PatientInfoViewModel

@{
	ViewData["Title"] = "Thông tin bệnh nhân";
	Layout = "~/Views/Shared/_DoctorLayout.cshtml";
}

<style>

	.info-pair-container {
		display: flex;
		gap: 20px;
		margin-bottom: 30px;
	}

	.info-box {
		flex: 1;
		background-color: #fff;
		border: 1px solid #ccc;
		border-left: 5px solid #0d6efd;
		padding: 20px;
		border-radius: 8px;
		box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
	}

	.sub-title {
		font-size: 16px;
		font-weight: bold;
		color: #0d6efd;
		margin-bottom: 16px;
		border-bottom: 1px solid #ccc;
		padding-bottom: 6px;
		text-transform: uppercase;
	}

	.form-grid {
		display: grid;
		grid-template-columns: 1fr 1fr;
		gap: 12px 24px;
	}

	.form-row {
		display: flex;
		flex-wrap: nowrap;
		align-items: center;
	}

	.form-label {
		width: 120px;
		font-weight: 500;
		color: #222;
	}

	.form-value {
		flex: 1;
		border-bottom: 1px solid #000;
		padding-left: 6px;
		min-height: 20px;
	}

	.form-row.full-width {
		flex-direction: column;
		align-items: flex-start;
		grid-column: span 2;
	}

		.form-row.full-width .form-label {
			width: auto;
			margin-bottom: 4px;
		}

		.form-row.full-width .form-value {
			width: 100%;
		}






	.medical-form {
		border: 1px solid #333;
		padding: 20px;
		background-color: #fff;
		font-size: 14px;
		line-height: 1.6;
	}

	.form-section-title {
		text-align: center;
		font-weight: bold;
		font-size: 16px;
		text-transform: uppercase;
		margin-bottom: 20px;
		text-decoration: underline;
	}

	.form-row {
		display: flex;
		flex-wrap: wrap;
		margin-bottom: 10px;
	}

	.form-col {
		flex: 1 1 50%;
		padding: 4px 8px;
	}

	.form-label {
		display: inline-block;
		width: 180px;
		font-weight: 500;
	}

	.form-value {
		display: inline-block;
		border-bottom: 1px solid #000;
		min-width: 120px;
		padding-left: 4px;
	}

</style>

<a class="btn btn-secondary mb-3"
   asp-controller="DoctorHome"
   asp-action="Details"
   asp-route-date="@Model?.Date.ToString("yyyy-MM-dd")"
   asp-route-period="@Model?.Period"
   asp-route-week="@Model?.Week"
   asp-route-year="@Model?.Year">
	← Quay lại lịch khám
</a>

@if (Model?.Patient == null || Model?.AppointmentSlot == null)
{
	<div class="alert alert-warning text-center">
		Không có thông tin bệnh nhân cho ca làm việc này.
	</div>
}
else
{
	<h3 class="mb-4 text-center">Thông tin bệnh nhân</h3>

	<div class="info-pair-container">
		<!-- Thông tin cá nhân -->
		<div class="info-box">
			<div class="sub-title">Thông tin cá nhân</div>
			<div class="form-grid">
				<div class="form-row">
					<div class="form-label">Họ tên:</div>
					<div class="form-value">@Model.Patient.FullName</div>
				</div>
				<div class="form-row">
					<div class="form-label">Giới tính:</div>
					<div class="form-value">@(Model.Patient.Gender ? "Nam" : "Nữ")</div>
				</div>
				<div class="form-row">
					<div class="form-label">Ngày sinh:</div>
					<div class="form-value">@Model.Patient.DateOfBirth.ToString("dd/MM/yyyy")</div>
				</div>
				<div class="form-row">
					<div class="form-label">CCCD:</div>
					<div class="form-value">@Model.Patient.Cccd</div>
				</div>
				<div class="form-row">
					<div class="form-label">Số điện thoại:</div>
					<div class="form-value">@Model.Patient.PhoneNumber</div>
				</div>
				<div class="form-row">
					<div class="form-label">Email:</div>
					<div class="form-value">@Model.Patient.Email</div>
				</div>
				<div class="form-row full-width">
					<div class="form-label">Địa chỉ:</div>
					<div class="form-value">@Model.Patient.Address</div>
				</div>

				<div class="form-row full-width">
					<div class="form-label">Mã BHYT:</div>
					<div class="form-value">@Model.Patient.Bhyt</div>
				</div>

			</div>
		</div>

		<!-- Thông tin lịch hẹn -->
		<div class="info-box">
			<div class="sub-title">Thông tin lịch hẹn</div>
			<div class="form-grid">
				<div class="form-row">
					<div class="form-label">Phòng khám:</div>
					<div class="form-value">@Model.AppointmentSlot.RoomName</div>
				</div>
				<div class="form-row">
					<div class="form-label">Ca khám:</div>
					<div class="form-value">@Model.AppointmentSlot.Shift</div>
				</div>
				<div class="form-row">
					<div class="form-label">Ngày đặt lịch:</div>
					<div class="form-value">@Model.AppointmentDetail.AppointmentDate.ToString("dd/MM/yyyy")</div>
				</div>

				<div class="form-row">
					<div class="form-label">Ngày hẹn:</div>
					<div class="form-value">@Model.AppointmentSlot.Date.ToString("dd/MM/yyyy")</div>
				</div>

				<div class="form-row">
					<div class="form-label">Thời gian:</div>
					<div class="form-value">@Model.AppointmentSlot.TimeStart - @Model.AppointmentSlot.TimeEnd</div>
				</div>
				<div class="form-row">
					<div class="form-label">Thời lượng:</div>
					<div class="form-value">@Model.AppointmentSlot.Duration</div>
				</div>
				<div class="form-row full-width">
					<div class="form-label">Ghi chú:</div>
					<div class="form-value">
						@(string.IsNullOrWhiteSpace(Model.AppointmentDetail?.Note) ? "Không có ghi chú" : Model.AppointmentDetail.Note)
					</div>
				</div>

			</div>
		</div>
	</div>


	<a asp-controller="DoctorHome"
	   asp-action="CreateMedicalRecord"
	   asp-route-patientId="@Model.Patient.Id"
	   asp-route-roomTimeSlotId="@Model.AppointmentSlot.Id"
	   asp-route-week="@Model.Week"
	   asp-route-year="@Model.Year"
	   asp-route-date="@Model.Date.ToString("yyyy-MM-dd")"
	   asp-route-period="@Model.Period"
	   class="btn btn-success mb-3">
		➕ Thêm hồ sơ bệnh án
	</a>

	@if (TempData["Success"] != null)
	{
		<div id="successAlert"
			 style="position: fixed; top: 30%; left: 50%; transform: translate(-50%, -50%); z-index: 9999;"
			 class="alert alert-success text-center shadow p-4 rounded-3">
			@TempData["Success"]
		</div>

		<script>
			setTimeout(function () {
				var alert = document.getElementById("successAlert");
				if (alert) alert.style.display = "none";
			}, 1000);
		</script>
	}


	@if (Model.Patient.MedicalRecords != null && Model.Patient.MedicalRecords.Any())
	{
		@foreach (var record in Model.Patient.MedicalRecords.OrderByDescending(r => r.LastUpdated))
		{
			<div class="medical-form mb-5">
				<div class="form-section-title">HỒ SƠ BỆNH ÁN</div>

				<div class="form-row">
					<div class="form-col">
						<span class="form-label">Họ tên:</span>
						<span class="form-value">@Model.Patient.FullName</span>
					</div>
					<div class="form-col">
						<span class="form-label">Giới tính:</span>
						<span class="form-value">@(Model.Patient.Gender ? "Nam" : "Nữ")</span>
					</div>
				</div>

				<div class="form-row">
					<div class="form-col">
						<span class="form-label">Ngày sinh:</span>
						<span class="form-value">@Model.Patient.DateOfBirth.ToString("dd/MM/yyyy")</span>
					</div>
					<div class="form-col">
						<span class="form-label">Nhóm máu:</span>
						<span class="form-value">@record.BloodType</span>
					</div>
				</div>

				<div class="form-row">
					<div class="form-col">
						<span class="form-label">Chiều cao:</span>
						<span class="form-value">@record.Height cm</span>
					</div>
					<div class="form-col">
						<span class="form-label">Cân nặng:</span>
						<span class="form-value">@record.Weight kg</span>
					</div>
				</div>

				<div class="form-row">
					<div class="form-col">
						<span class="form-label">Dị ứng:</span>
						<span class="form-value">@record.Allergies</span>
					</div>
					<div class="form-col">
						<span class="form-label">Bệnh mãn tính:</span>
						<span class="form-value">@record.Chronic</span>
					</div>
				</div>

				<div class="form-row">
					<div class="form-col">
						<span class="form-label">Tiền sử bệnh:</span>
						<span class="form-value">@record.MedicalHistory</span>
					</div>
					<div class="form-col">
						<span class="form-label">Triệu chứng:</span>
						<span class="form-value">@record.Symptoms</span>
					</div>
				</div>

				<div class="form-row">
					<div class="form-col">
						<span class="form-label">Chẩn đoán:</span>
						<span class="form-value">@record.Diagnosis</span>
					</div>
					<div class="form-col">
						<span class="form-label">Kết quả khám:</span>
						<span class="form-value">@record.MedicalResult</span>
					</div>
				</div>

				<div class="form-row">
					<div class="form-col">
						<span class="form-label">Khoa đã khám:</span>
						<span class="form-value">@record.DepartmentVisited</span>
					</div>
					<div class="form-col">
						<span class="form-label">Bác sĩ khám:</span>
						<span class="form-value">@record.DoctorName</span>
					</div>
				</div>

				<div class="form-row">
					<div class="form-col">
						<span class="form-label">Đơn thuốc:</span>
						<span class="form-value">@record.Medications</span>
					</div>
					<div class="form-col">
						<span class="form-label">Kế hoạch điều trị:</span>
						<span class="form-value">@record.TreatmentPlan</span>
					</div>
				</div>

				<div class="form-row">
					<div class="form-col">
						<span class="form-label">Huyết áp:</span>
						<span class="form-value">@record.VitalSigns</span>
					</div>
					<div class="form-col">
						<span class="form-label">Lịch hẹn tái khám:</span>
						<span class="form-value">@(record.NextAppointmentDate?.ToString("dd/MM/yyyy") ?? "Không có")</span>
					</div>
				</div>

				<div class="text-end mt-3">
					<em>Cập nhật lần cuối: @record.LastUpdated</em>
				</div>
			</div>
		}

	}
	else
	{
		<div class="alert alert-info text-center">
			Không có hồ sơ y tế nào.
		</div>
	}
}
